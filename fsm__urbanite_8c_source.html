<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project Template: common/src/fsm_urbanite.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project Template
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('fsm__urbanite_8c_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">fsm_urbanite.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="fsm__urbanite_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; </div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">/* Includes ------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">/* Standard C includes */</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">/* HW dependent includes */</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="port__system_8h.html">port_system.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">/* FSM includes */</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="fsm__urbanite_8h.html">fsm_urbanite.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/* State machine input or transition functions */</span></div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="fsm__urbanite_8c.html#ab64512dbce31c38a36bff5e337f4fb8f">   32</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="fsm__urbanite_8c.html#ab64512dbce31c38a36bff5e337f4fb8f">check_on</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;{</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *p_fsm_urbanite = (<a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *)(p_this);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="comment">// Check if the button has been pressed for the required time</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    uint32_t duration = <a class="code" href="fsm__button_8h.html#a8ceba02b9a4674bb307147638a4cf3fc">fsm_button_get_duration</a>(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#aef90d3298f0b52fc4eb4c0e2a376c11e">p_fsm_button</a>);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordflow">return</span> (duration &amp;&amp; (duration &gt;= p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#a34aaf1f8c33629dd06e928b8e605476e">on_off_press_time_ms</a>));</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;}</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="fsm__urbanite_8c.html#a941bb12de41897bba2b612cc87b3164b">   52</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="fsm__urbanite_8c.html#a941bb12de41897bba2b612cc87b3164b">check_off</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;{</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="fsm__urbanite_8c.html#ab64512dbce31c38a36bff5e337f4fb8f">check_on</a>(p_this); <span class="comment">// Estamos usando el mismo tiempo y por eso llamamos a la función check_on. Optimización de código</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;}</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> check_new_measure(fsm_t *p_this)</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;{</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *p_fsm_urbanite = (<a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *)(p_this);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordtype">bool</span> new_measure = fsm_ultrasound_get_new_measurement_ready(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#ae3285f1fafc692225346e66df7bb5b10">p_fsm_ultrasound_rear</a>);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">return</span> new_measure;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;}</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> check_pause_display(fsm_t *p_this)</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;{</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *p_fsm_urbanite = (<a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *)(p_this);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    uint32_t duration = <a class="code" href="fsm__button_8h.html#a8ceba02b9a4674bb307147638a4cf3fc">fsm_button_get_duration</a>(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#aef90d3298f0b52fc4eb4c0e2a376c11e">p_fsm_button</a>);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">return</span> (duration &amp;&amp; (duration &lt; p_fsm_urbanite-&gt;on_off_press_time_ms) &amp;&amp; (duration &gt; p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#ae0eea2a7dc64b32fa288a884a0d1649c">pause_display_time_ms</a>));</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;}</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="fsm__urbanite_8c.html#a91c31f180f16c2d66ef56e62004c83bc">   82</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="fsm__urbanite_8c.html#a91c31f180f16c2d66ef56e62004c83bc">check_activity</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;{</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *p_fsm_urbanite = (<a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *)(p_this);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordtype">bool</span> button_active = <a class="code" href="fsm__button_8h.html#a9b5728721dbfc410b27b4a5af1da1bb8">fsm_button_check_activity</a>(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#aef90d3298f0b52fc4eb4c0e2a376c11e">p_fsm_button</a>);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordtype">bool</span> ultrasound_active = <a class="code" href="fsm__ultrasound_8h.html#a24f4ccdcf05a371db248413cca46e845">fsm_ultrasound_check_activity</a>(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#ae3285f1fafc692225346e66df7bb5b10">p_fsm_ultrasound_rear</a>);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordtype">bool</span> display_active = fsm_display_check_activity(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#ad5768c349c39b2ed10dfe2478e8078ec">p_fsm_display_rear</a>);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">return</span> button_active || ultrasound_active || display_active;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;}</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="fsm__urbanite_8c.html#a05439bd432881a570511d46a7d2ff699">  104</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="fsm__urbanite_8c.html#a05439bd432881a570511d46a7d2ff699">check_no_activity</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;{</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">return</span> !<a class="code" href="fsm__urbanite_8c.html#a91c31f180f16c2d66ef56e62004c83bc">check_activity</a>(p_this);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> check_activity_in_measure(fsm_t *p_this)</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;{</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">return</span> check_new_measure(p_this);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;}</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">/* State machine output or action functions */</span></div>
<div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="fsm__urbanite_8c.html#a6ed418c9291c1c9a2c6d13b3fd1c0d6e">  126</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="fsm__urbanite_8c.html#a6ed418c9291c1c9a2c6d13b3fd1c0d6e">do_start_up_measure</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;{</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *p_fsm_urbanite = (<a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *)(p_this);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <a class="code" href="fsm__button_8h.html#a911736d0a80d826cf083b94d049aacee">fsm_button_reset_duration</a>(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#aef90d3298f0b52fc4eb4c0e2a376c11e">p_fsm_button</a>); <span class="comment">/* Reseteo la duración siempre que sea mayor que 0. Es MUY importante. Es como limpiar un flag de una FSM, pero este flag es algo más que eso, es que además me da la duración */</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">// Start the measurement of the ultrasound sensor</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    fsm_ultrasound_start(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#ae3285f1fafc692225346e66df7bb5b10">p_fsm_ultrasound_rear</a>);      <span class="comment">// Activamos el sensor de ultrasonidos</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    fsm_display_set_status(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#ad5768c349c39b2ed10dfe2478e8078ec">p_fsm_display_rear</a>, <span class="keyword">true</span>); <span class="comment">// Activamos el display</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    printf(<span class="stringliteral">&quot;[URBANITE][%ld] Urbanite system ON\n&quot;</span>, <a class="code" href="port__system_8h.html#ab415270cfcefc90ed8b8842da4e3d4c6">port_system_get_millis</a>());</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;}</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> do_display_distance(fsm_t *p_this)</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;{</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *p_fsm_urbanite = (<a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *)(p_this);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">// Get the distance measured by the ultrasound sensor</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    int32_t distance_cm = <a class="code" href="fsm__ultrasound_8h.html#aff92f27acb083d23359ccfedbbae8012">fsm_ultrasound_get_distance</a>(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#ae3285f1fafc692225346e66df7bb5b10">p_fsm_ultrasound_rear</a>);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">// Set the distance to the display</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">if</span> (p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#a99794bf9667eecffa32f28c4e4e6dbc1">is_paused</a>)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">if</span> (distance_cm &lt; 12)</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            fsm_display_set_distance(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#ad5768c349c39b2ed10dfe2478e8078ec">p_fsm_display_rear</a>, distance_cm);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            fsm_display_set_status(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#ad5768c349c39b2ed10dfe2478e8078ec">p_fsm_display_rear</a>, <span class="keyword">true</span>); <span class="comment">// Ensure that the display is turned off if the distance is greater than 12 cm and the system is paused</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        }</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            fsm_display_set_status(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#ad5768c349c39b2ed10dfe2478e8078ec">p_fsm_display_rear</a>, <span class="keyword">false</span>); <span class="comment">// Ensure that the display is turned off if the distance is greater than 12 cm and the system is paused</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        fsm_display_set_distance(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#ad5768c349c39b2ed10dfe2478e8078ec">p_fsm_display_rear</a>, distance_cm);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    printf(<span class="stringliteral">&quot;[URBANITE][%ld] Distance: %ld cm\n&quot;</span>, <a class="code" href="port__system_8h.html#ab415270cfcefc90ed8b8842da4e3d4c6">port_system_get_millis</a>(), distance_cm);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;}</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> do_pause_display(fsm_t *p_this)</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;{</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *p_fsm_urbanite = (<a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *)(p_this);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <a class="code" href="fsm__button_8h.html#a911736d0a80d826cf083b94d049aacee">fsm_button_reset_duration</a>(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#aef90d3298f0b52fc4eb4c0e2a376c11e">p_fsm_button</a>); <span class="comment">/* Reseteo la duración siempre que sea mayor que 0. Es MUY importante. Es como limpiar un flag de una FSM, pero este flag es algo más que eso, es que además me da la duración */</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">// Invert the pause status</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#a99794bf9667eecffa32f28c4e4e6dbc1">is_paused</a> = !p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#a99794bf9667eecffa32f28c4e4e6dbc1">is_paused</a>;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">// Activate or deactivate the display depending on the pause status</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    fsm_display_set_status(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#ad5768c349c39b2ed10dfe2478e8078ec">p_fsm_display_rear</a>, !p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#a99794bf9667eecffa32f28c4e4e6dbc1">is_paused</a>);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">// Print status</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">if</span> (p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#a99794bf9667eecffa32f28c4e4e6dbc1">is_paused</a>)</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        printf(<span class="stringliteral">&quot;[URBANITE][%ld] Urbanite system display PAUSE\n&quot;</span>, <a class="code" href="port__system_8h.html#ab415270cfcefc90ed8b8842da4e3d4c6">port_system_get_millis</a>());</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        printf(<span class="stringliteral">&quot;[URBANITE][%ld] Urbanite system display RESUME\n&quot;</span>, <a class="code" href="port__system_8h.html#ab415270cfcefc90ed8b8842da4e3d4c6">port_system_get_millis</a>());</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;}</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno"><a class="line" href="fsm__urbanite_8c.html#aad4789790f16502c7e952755d895b492">  201</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="fsm__urbanite_8c.html#aad4789790f16502c7e952755d895b492">do_stop_urbanite</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;{</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *p_fsm_urbanite = (<a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *)(p_this);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <a class="code" href="fsm__button_8h.html#a911736d0a80d826cf083b94d049aacee">fsm_button_reset_duration</a>(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#aef90d3298f0b52fc4eb4c0e2a376c11e">p_fsm_button</a>);           <span class="comment">/* Reseteo la duración siempre que sea mayor que 0. Es MUY importante. Es como limpiar un flag de una FSM, pero este flag es algo más que eso, es que además me da la duración */</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    fsm_ultrasound_stop(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#ae3285f1fafc692225346e66df7bb5b10">p_fsm_ultrasound_rear</a>);        <span class="comment">// Desactivamos el sensor de ultrasonidos</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    fsm_display_set_status(p_fsm_urbanite-&gt;<a class="code" href="structfsm__urbanite__t.html#ad5768c349c39b2ed10dfe2478e8078ec">p_fsm_display_rear</a>, <span class="keyword">false</span>); <span class="comment">// Desactivamos el display</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    printf(<span class="stringliteral">&quot;[URBANITE][%ld] Urbanite system OFF\n&quot;</span>, <a class="code" href="port__system_8h.html#ab415270cfcefc90ed8b8842da4e3d4c6">port_system_get_millis</a>());</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;}</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00221"></a><span class="lineno"><a class="line" href="fsm__urbanite_8c.html#a6a4825398f34ad61ae90c794df3fdaae">  221</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="fsm__urbanite_8c.html#a6a4825398f34ad61ae90c794df3fdaae">do_sleep_while_off</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;{</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <a class="code" href="port__system_8h.html#ae3c6ff19d65f5cdeb1e1b556b0823b40">port_system_sleep</a>();</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;}</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno"><a class="line" href="fsm__urbanite_8c.html#aad10008c814d0625ee12467bc836d702">  235</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="fsm__urbanite_8c.html#aad10008c814d0625ee12467bc836d702">do_sleep_while_on</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;{</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="port__system_8h.html#ae3c6ff19d65f5cdeb1e1b556b0823b40">port_system_sleep</a>();</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> do_sleep_while_measure(fsm_t *p_this)</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;{</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <a class="code" href="port__system_8h.html#ae3c6ff19d65f5cdeb1e1b556b0823b40">port_system_sleep</a>();</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;}</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno"><a class="line" href="fsm__urbanite_8c.html#a9d2922e21185739c528166e38ed8ab3b">  254</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="fsm__urbanite_8c.html#a9d2922e21185739c528166e38ed8ab3b">do_sleep_off</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;{</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <a class="code" href="port__system_8h.html#ae3c6ff19d65f5cdeb1e1b556b0823b40">port_system_sleep</a>();</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;}</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">/* Esto tiene que estar aquí pq las funciones de la FSM son internas */</span></div>
<div class="line"><a name="l00267"></a><span class="lineno"><a class="line" href="fsm__urbanite_8c.html#aeba21fd1038f0c56fc5d6b1aaa9e2148">  267</a></span>&#160;fsm_trans_t <a class="code" href="fsm__urbanite_8c.html#aeba21fd1038f0c56fc5d6b1aaa9e2148">fsm_trans_urbanite</a>[] = {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    {<a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718eaac132f2982b98bcaa3445e535a03ff75">OFF</a>, <a class="code" href="fsm__urbanite_8c.html#ab64512dbce31c38a36bff5e337f4fb8f">check_on</a>, <a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718ea10b4381a926db55ed18619513fb12a28">MEASURE</a>, <a class="code" href="fsm__urbanite_8c.html#a6ed418c9291c1c9a2c6d13b3fd1c0d6e">do_start_up_measure</a>}, <span class="comment">// El estado OFF es el estado inicial, por eso esta transición debe ser la primera</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    {<a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718eaac132f2982b98bcaa3445e535a03ff75">OFF</a>, <a class="code" href="fsm__urbanite_8c.html#a05439bd432881a570511d46a7d2ff699">check_no_activity</a>, <a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718ea30dd63ccd40677f8b3eb01f8ad352ce7">SLEEP_WHILE_OFF</a>, <a class="code" href="fsm__urbanite_8c.html#a9d2922e21185739c528166e38ed8ab3b">do_sleep_off</a>},</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    {<a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718ea10b4381a926db55ed18619513fb12a28">MEASURE</a>, <a class="code" href="fsm__urbanite_8c.html#a941bb12de41897bba2b612cc87b3164b">check_off</a>, <a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718eaac132f2982b98bcaa3445e535a03ff75">OFF</a>, <a class="code" href="fsm__urbanite_8c.html#aad4789790f16502c7e952755d895b492">do_stop_urbanite</a>},</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    {<a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718ea10b4381a926db55ed18619513fb12a28">MEASURE</a>, check_pause_display, <a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718ea10b4381a926db55ed18619513fb12a28">MEASURE</a>, do_pause_display},</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    {<a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718ea10b4381a926db55ed18619513fb12a28">MEASURE</a>, check_new_measure, <a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718ea10b4381a926db55ed18619513fb12a28">MEASURE</a>, do_display_distance},</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    {<a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718ea10b4381a926db55ed18619513fb12a28">MEASURE</a>, <a class="code" href="fsm__urbanite_8c.html#a05439bd432881a570511d46a7d2ff699">check_no_activity</a>, <a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718eacfc8a9bfe175888d8890411703c267f4">SLEEP_WHILE_ON</a>, do_sleep_while_measure}, <span class="comment">// Todos los sleep son iguales, pero para facilitar la depuración y saber dónde estoy en cada momento, los pongo con funciones separadas</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    {<a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718ea30dd63ccd40677f8b3eb01f8ad352ce7">SLEEP_WHILE_OFF</a>, <a class="code" href="fsm__urbanite_8c.html#a91c31f180f16c2d66ef56e62004c83bc">check_activity</a>, <a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718eaac132f2982b98bcaa3445e535a03ff75">OFF</a>, NULL},</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    {<a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718ea30dd63ccd40677f8b3eb01f8ad352ce7">SLEEP_WHILE_OFF</a>, <a class="code" href="fsm__urbanite_8c.html#a05439bd432881a570511d46a7d2ff699">check_no_activity</a>, <a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718ea30dd63ccd40677f8b3eb01f8ad352ce7">SLEEP_WHILE_OFF</a>, <a class="code" href="fsm__urbanite_8c.html#a6a4825398f34ad61ae90c794df3fdaae">do_sleep_while_off</a>}, <span class="comment">// Esta transición es util solo para depurar, cuando se despierta por un punto de interrupción, por ejemplo</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    {<a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718eacfc8a9bfe175888d8890411703c267f4">SLEEP_WHILE_ON</a>, check_activity_in_measure, <a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718ea10b4381a926db55ed18619513fb12a28">MEASURE</a>, NULL},</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    {<a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718eacfc8a9bfe175888d8890411703c267f4">SLEEP_WHILE_ON</a>, <a class="code" href="fsm__urbanite_8c.html#a05439bd432881a570511d46a7d2ff699">check_no_activity</a>, <a class="code" href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718eacfc8a9bfe175888d8890411703c267f4">SLEEP_WHILE_ON</a>, <a class="code" href="fsm__urbanite_8c.html#aad10008c814d0625ee12467bc836d702">do_sleep_while_on</a>}, <span class="comment">// Esta transición es util solo para depurar, cuando se despierta por un punto de interrupción, por ejemplo</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    {-1, NULL, -1, NULL},</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;};</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">/* Public functions -----------------------------------------------------------*/</span></div>
<div class="line"><a name="l00285"></a><span class="lineno"><a class="line" href="fsm__urbanite_8c.html#ae6d50a1c3ff856e2ce0b926b30193bcc">  285</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="fsm__urbanite_8c.html#ae6d50a1c3ff856e2ce0b926b30193bcc">fsm_urbanite_init</a>(<a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *p_fsm_urbanite, <a class="code" href="structfsm__button__t.html">fsm_button_t</a> *p_fsm_button, uint32_t on_off_press_time_ms, uint32_t pause_display_time_ms, <a class="code" href="structfsm__ultrasound__t.html">fsm_ultrasound_t</a> *p_fsm_ultrasound_rear, <a class="code" href="structfsm__display__t.html">fsm_display_t</a> *p_fsm_display_rear)</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;{</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    fsm_init((fsm_t *)p_fsm_urbanite, <a class="code" href="fsm__urbanite_8c.html#aeba21fd1038f0c56fc5d6b1aaa9e2148">fsm_trans_urbanite</a>);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    p_fsm_urbanite-&gt;p_fsm_button = p_fsm_button;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    p_fsm_urbanite-&gt;on_off_press_time_ms = on_off_press_time_ms;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    p_fsm_urbanite-&gt;pause_display_time_ms = pause_display_time_ms;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    p_fsm_urbanite-&gt;is_paused = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    p_fsm_urbanite-&gt;p_fsm_ultrasound_rear = p_fsm_ultrasound_rear;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    p_fsm_urbanite-&gt;p_fsm_display_rear = p_fsm_display_rear;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;}</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno"><a class="line" href="fsm__urbanite_8c.html#a0cb1e5b600d89599e654890a67c55b1b">  297</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="fsm__urbanite_8c.html#a0cb1e5b600d89599e654890a67c55b1b">fsm_urbanite_fire</a>(<a class="code" href="structfsm__urbanite__t.html">fsm_urbanite_t</a> *p_fsm_urbanite)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;{</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    fsm_fire((fsm_t *)p_fsm_urbanite);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="astructfsm__urbanite__t_html_a34aaf1f8c33629dd06e928b8e605476e"><div class="ttname"><a href="structfsm__urbanite__t.html#a34aaf1f8c33629dd06e928b8e605476e">fsm_urbanite_t::on_off_press_time_ms</a></div><div class="ttdeci">uint32_t on_off_press_time_ms</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8h_source.html#l00048">fsm_urbanite.h:48</a></div></div>
<div class="ttc" id="afsm__button_8h_html_a9b5728721dbfc410b27b4a5af1da1bb8"><div class="ttname"><a href="fsm__button_8h.html#a9b5728721dbfc410b27b4a5af1da1bb8">fsm_button_check_activity</a></div><div class="ttdeci">bool fsm_button_check_activity(fsm_button_t *p_fsm)</div><div class="ttdoc">Check if the button FSM is active, or not.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__button_8c_source.html#l00210">fsm_button.c:210</a></div></div>
<div class="ttc" id="afsm__urbanite_8c_html_a9d2922e21185739c528166e38ed8ab3b"><div class="ttname"><a href="fsm__urbanite_8c.html#a9d2922e21185739c528166e38ed8ab3b">do_sleep_off</a></div><div class="ttdeci">static void do_sleep_off(fsm_t *p_this)</div><div class="ttdoc">Start the low power mode while the Urbanite is OFF.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8c_source.html#l00254">fsm_urbanite.c:254</a></div></div>
<div class="ttc" id="afsm__urbanite_8c_html_aeba21fd1038f0c56fc5d6b1aaa9e2148"><div class="ttname"><a href="fsm__urbanite_8c.html#aeba21fd1038f0c56fc5d6b1aaa9e2148">fsm_trans_urbanite</a></div><div class="ttdeci">fsm_trans_t fsm_trans_urbanite[]</div><div class="ttdoc">Array representing the transitions table of the FSM Urbanite.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8c_source.html#l00267">fsm_urbanite.c:267</a></div></div>
<div class="ttc" id="afsm__urbanite_8c_html_a91c31f180f16c2d66ef56e62004c83bc"><div class="ttname"><a href="fsm__urbanite_8c.html#a91c31f180f16c2d66ef56e62004c83bc">check_activity</a></div><div class="ttdeci">static bool check_activity(fsm_t *p_this)</div><div class="ttdoc">Check if any of the elements of the system is active.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8c_source.html#l00082">fsm_urbanite.c:82</a></div></div>
<div class="ttc" id="afsm__urbanite_8c_html_ae6d50a1c3ff856e2ce0b926b30193bcc"><div class="ttname"><a href="fsm__urbanite_8c.html#ae6d50a1c3ff856e2ce0b926b30193bcc">fsm_urbanite_init</a></div><div class="ttdeci">void fsm_urbanite_init(fsm_urbanite_t *p_fsm_urbanite, fsm_button_t *p_fsm_button, uint32_t on_off_press_time_ms, uint32_t pause_display_time_ms, fsm_ultrasound_t *p_fsm_ultrasound_rear, fsm_display_t *p_fsm_display_rear)</div><div class="ttdoc">Create a new Urbanite FSM.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8c_source.html#l00285">fsm_urbanite.c:285</a></div></div>
<div class="ttc" id="afsm__urbanite_8h_html_ab3c277bf810895db38a66dc3fc7e718eacfc8a9bfe175888d8890411703c267f4"><div class="ttname"><a href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718eacfc8a9bfe175888d8890411703c267f4">SLEEP_WHILE_ON</a></div><div class="ttdeci">@ SLEEP_WHILE_ON</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8h_source.html#l00035">fsm_urbanite.h:35</a></div></div>
<div class="ttc" id="afsm__urbanite_8c_html_a6a4825398f34ad61ae90c794df3fdaae"><div class="ttname"><a href="fsm__urbanite_8c.html#a6a4825398f34ad61ae90c794df3fdaae">do_sleep_while_off</a></div><div class="ttdeci">static void do_sleep_while_off(fsm_t *p_this)</div><div class="ttdoc">Start the low power mode while the Urbanite is OFF.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8c_source.html#l00221">fsm_urbanite.c:221</a></div></div>
<div class="ttc" id="astructfsm__urbanite__t_html_ae3285f1fafc692225346e66df7bb5b10"><div class="ttname"><a href="structfsm__urbanite__t.html#ae3285f1fafc692225346e66df7bb5b10">fsm_urbanite_t::p_fsm_ultrasound_rear</a></div><div class="ttdeci">fsm_ultrasound_t * p_fsm_ultrasound_rear</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8h_source.html#l00051">fsm_urbanite.h:51</a></div></div>
<div class="ttc" id="astructfsm__ultrasound__t_html"><div class="ttname"><a href="structfsm__ultrasound__t.html">fsm_ultrasound_t</a></div><div class="ttdoc">Structure to define the Ultrasound FSM.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__ultrasound_8c_source.html#l00043">fsm_ultrasound.c:43</a></div></div>
<div class="ttc" id="afsm__button_8h_html_a8ceba02b9a4674bb307147638a4cf3fc"><div class="ttname"><a href="fsm__button_8h.html#a8ceba02b9a4674bb307147638a4cf3fc">fsm_button_get_duration</a></div><div class="ttdeci">uint32_t fsm_button_get_duration(fsm_button_t *p_fsm)</div><div class="ttdoc">Return the duration of the last button press.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__button_8c_source.html#l00192">fsm_button.c:192</a></div></div>
<div class="ttc" id="astructfsm__urbanite__t_html_aef90d3298f0b52fc4eb4c0e2a376c11e"><div class="ttname"><a href="structfsm__urbanite__t.html#aef90d3298f0b52fc4eb4c0e2a376c11e">fsm_urbanite_t::p_fsm_button</a></div><div class="ttdeci">fsm_button_t * p_fsm_button</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8h_source.html#l00047">fsm_urbanite.h:47</a></div></div>
<div class="ttc" id="afsm__urbanite_8h_html_ab3c277bf810895db38a66dc3fc7e718ea30dd63ccd40677f8b3eb01f8ad352ce7"><div class="ttname"><a href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718ea30dd63ccd40677f8b3eb01f8ad352ce7">SLEEP_WHILE_OFF</a></div><div class="ttdeci">@ SLEEP_WHILE_OFF</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8h_source.html#l00034">fsm_urbanite.h:34</a></div></div>
<div class="ttc" id="astructfsm__urbanite__t_html_a99794bf9667eecffa32f28c4e4e6dbc1"><div class="ttname"><a href="structfsm__urbanite__t.html#a99794bf9667eecffa32f28c4e4e6dbc1">fsm_urbanite_t::is_paused</a></div><div class="ttdeci">bool is_paused</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8h_source.html#l00050">fsm_urbanite.h:50</a></div></div>
<div class="ttc" id="afsm__ultrasound_8h_html_aff92f27acb083d23359ccfedbbae8012"><div class="ttname"><a href="fsm__ultrasound_8h.html#aff92f27acb083d23359ccfedbbae8012">fsm_ultrasound_get_distance</a></div><div class="ttdeci">uint32_t fsm_ultrasound_get_distance(fsm_ultrasound_t *p_fsm)</div><div class="ttdoc">Return the distance of the last object detected by the ultrasound sensor.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__ultrasound_8c_source.html#l00248">fsm_ultrasound.c:248</a></div></div>
<div class="ttc" id="astructfsm__urbanite__t_html"><div class="ttname"><a href="structfsm__urbanite__t.html">fsm_urbanite_t</a></div><div class="ttdoc">Structure that contains the information of a distance measurement system.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8h_source.html#l00043">fsm_urbanite.h:43</a></div></div>
<div class="ttc" id="aport__system_8h_html_ab415270cfcefc90ed8b8842da4e3d4c6"><div class="ttname"><a href="port__system_8h.html#ab415270cfcefc90ed8b8842da4e3d4c6">port_system_get_millis</a></div><div class="ttdeci">uint32_t port_system_get_millis(void)</div><div class="ttdoc">Returns the number of milliseconds since the system started.</div><div class="ttdef"><b>Definition:</b> <a href="stm32f4__system_8c_source.html#l00178">stm32f4_system.c:178</a></div></div>
<div class="ttc" id="afsm__ultrasound_8h_html_a24f4ccdcf05a371db248413cca46e845"><div class="ttname"><a href="fsm__ultrasound_8h.html#a24f4ccdcf05a371db248413cca46e845">fsm_ultrasound_check_activity</a></div><div class="ttdeci">bool fsm_ultrasound_check_activity(fsm_ultrasound_t *p_fsm)</div><div class="ttdoc">Check if the ultrasound sensor is doing a distance measurement.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__ultrasound_8c_source.html#l00291">fsm_ultrasound.c:291</a></div></div>
<div class="ttc" id="afsm__urbanite_8c_html_a941bb12de41897bba2b612cc87b3164b"><div class="ttname"><a href="fsm__urbanite_8c.html#a941bb12de41897bba2b612cc87b3164b">check_off</a></div><div class="ttdeci">static bool check_off(fsm_t *p_this)</div><div class="ttdoc">Check if the button has been pressed for the required time to turn OFF the system.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8c_source.html#l00052">fsm_urbanite.c:52</a></div></div>
<div class="ttc" id="aport__system_8h_html"><div class="ttname"><a href="port__system_8h.html">port_system.h</a></div><div class="ttdoc">: Header for port_system.c file.</div></div>
<div class="ttc" id="astructfsm__display__t_html"><div class="ttname"><a href="structfsm__display__t.html">fsm_display_t</a></div><div class="ttdef"><b>Definition:</b> <a href="fsm__display_8c_source.html#l00037">fsm_display.c:37</a></div></div>
<div class="ttc" id="astructfsm__urbanite__t_html_ad5768c349c39b2ed10dfe2478e8078ec"><div class="ttname"><a href="structfsm__urbanite__t.html#ad5768c349c39b2ed10dfe2478e8078ec">fsm_urbanite_t::p_fsm_display_rear</a></div><div class="ttdeci">fsm_display_t * p_fsm_display_rear</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8h_source.html#l00052">fsm_urbanite.h:52</a></div></div>
<div class="ttc" id="afsm__urbanite_8c_html_a05439bd432881a570511d46a7d2ff699"><div class="ttname"><a href="fsm__urbanite_8c.html#a05439bd432881a570511d46a7d2ff699">check_no_activity</a></div><div class="ttdeci">static bool check_no_activity(fsm_t *p_this)</div><div class="ttdoc">Check if all the is system active.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8c_source.html#l00104">fsm_urbanite.c:104</a></div></div>
<div class="ttc" id="astructfsm__button__t_html"><div class="ttname"><a href="structfsm__button__t.html">fsm_button_t</a></div><div class="ttdoc">Structure to define the Button FSM.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__button_8c_source.html#l00023">fsm_button.c:23</a></div></div>
<div class="ttc" id="afsm__urbanite_8c_html_a0cb1e5b600d89599e654890a67c55b1b"><div class="ttname"><a href="fsm__urbanite_8c.html#a0cb1e5b600d89599e654890a67c55b1b">fsm_urbanite_fire</a></div><div class="ttdeci">void fsm_urbanite_fire(fsm_urbanite_t *p_fsm_urbanite)</div><div class="ttdoc">Fire the Urbanite FSM.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8c_source.html#l00297">fsm_urbanite.c:297</a></div></div>
<div class="ttc" id="afsm__urbanite_8c_html_ab64512dbce31c38a36bff5e337f4fb8f"><div class="ttname"><a href="fsm__urbanite_8c.html#ab64512dbce31c38a36bff5e337f4fb8f">check_on</a></div><div class="ttdeci">static bool check_on(fsm_t *p_this)</div><div class="ttdoc">Check if the button has been pressed for the required time to turn ON the Urbanite system.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8c_source.html#l00032">fsm_urbanite.c:32</a></div></div>
<div class="ttc" id="afsm__button_8h_html_a911736d0a80d826cf083b94d049aacee"><div class="ttname"><a href="fsm__button_8h.html#a911736d0a80d826cf083b94d049aacee">fsm_button_reset_duration</a></div><div class="ttdeci">void fsm_button_reset_duration(fsm_button_t *p_fsm)</div><div class="ttdoc">Reset the duration of the last button press.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__button_8c_source.html#l00199">fsm_button.c:199</a></div></div>
<div class="ttc" id="afsm__urbanite_8c_html_aad10008c814d0625ee12467bc836d702"><div class="ttname"><a href="fsm__urbanite_8c.html#aad10008c814d0625ee12467bc836d702">do_sleep_while_on</a></div><div class="ttdeci">static void do_sleep_while_on(fsm_t *p_this)</div><div class="ttdoc">Start the low power mode while the Urbanite is ON.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8c_source.html#l00235">fsm_urbanite.c:235</a></div></div>
<div class="ttc" id="afsm__urbanite_8c_html_a6ed418c9291c1c9a2c6d13b3fd1c0d6e"><div class="ttname"><a href="fsm__urbanite_8c.html#a6ed418c9291c1c9a2c6d13b3fd1c0d6e">do_start_up_measure</a></div><div class="ttdeci">static void do_start_up_measure(fsm_t *p_this)</div><div class="ttdoc">Turn the Urbanite system ON.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8c_source.html#l00126">fsm_urbanite.c:126</a></div></div>
<div class="ttc" id="afsm__urbanite_8c_html_aad4789790f16502c7e952755d895b492"><div class="ttname"><a href="fsm__urbanite_8c.html#aad4789790f16502c7e952755d895b492">do_stop_urbanite</a></div><div class="ttdeci">static void do_stop_urbanite(fsm_t *p_this)</div><div class="ttdoc">Turn the Urbanite system OFF.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8c_source.html#l00201">fsm_urbanite.c:201</a></div></div>
<div class="ttc" id="afsm__urbanite_8h_html_ab3c277bf810895db38a66dc3fc7e718ea10b4381a926db55ed18619513fb12a28"><div class="ttname"><a href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718ea10b4381a926db55ed18619513fb12a28">MEASURE</a></div><div class="ttdeci">@ MEASURE</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8h_source.html#l00032">fsm_urbanite.h:32</a></div></div>
<div class="ttc" id="afsm__urbanite_8h_html_ab3c277bf810895db38a66dc3fc7e718eaac132f2982b98bcaa3445e535a03ff75"><div class="ttname"><a href="fsm__urbanite_8h.html#ab3c277bf810895db38a66dc3fc7e718eaac132f2982b98bcaa3445e535a03ff75">OFF</a></div><div class="ttdeci">@ OFF</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8h_source.html#l00031">fsm_urbanite.h:31</a></div></div>
<div class="ttc" id="afsm__urbanite_8h_html"><div class="ttname"><a href="fsm__urbanite_8h.html">fsm_urbanite.h</a></div><div class="ttdoc">Header for fsm_urbanite.c file.</div></div>
<div class="ttc" id="astructfsm__urbanite__t_html_ae0eea2a7dc64b32fa288a884a0d1649c"><div class="ttname"><a href="structfsm__urbanite__t.html#ae0eea2a7dc64b32fa288a884a0d1649c">fsm_urbanite_t::pause_display_time_ms</a></div><div class="ttdeci">uint32_t pause_display_time_ms</div><div class="ttdef"><b>Definition:</b> <a href="fsm__urbanite_8h_source.html#l00049">fsm_urbanite.h:49</a></div></div>
<div class="ttc" id="aport__system_8h_html_ae3c6ff19d65f5cdeb1e1b556b0823b40"><div class="ttname"><a href="port__system_8h.html#ae3c6ff19d65f5cdeb1e1b556b0823b40">port_system_sleep</a></div><div class="ttdeci">void port_system_sleep(void)</div><div class="ttdoc">Enable low power consumption in sleep mode.</div><div class="ttdef"><b>Definition:</b> <a href="stm32f4__system_8c_source.html#l00362">stm32f4_system.c:362</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_bdd9a5d540de89e9fe90efdfc6973a4f.html">common</a></li><li class="navelem"><a class="el" href="dir_4e4d22e38ca4e2e8207825ee2d00bc54.html">src</a></li><li class="navelem"><a class="el" href="fsm__urbanite_8c.html">fsm_urbanite.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
