<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Urbanite: Parking aid system: port/stm32f4/src/stm32f4_ultrasound.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Urbanite: Parking aid system
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('stm32f4__ultrasound_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">stm32f4_ultrasound.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Portable functions to interact with the ultrasound FSM library. All portable functions must be implemented in this file.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &quot;<a class="el" href="port__ultrasound_8h.html">port_ultrasound.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="port__system_8h.html">port_system.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="stm32f4__system_8h.html">stm32f4_system.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="stm32f4__ultrasound_8h.html">stm32f4_ultrasound.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structstm32f4__ultrasound__hw__t.html">stm32f4_ultrasound_hw_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure to define the HW dependencies of aN ultrasound sensor.  <a href="structstm32f4__ultrasound__hw__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a25c1bd959768a66ebfdc3c4995b128a2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structstm32f4__ultrasound__hw__t.html">stm32f4_ultrasound_hw_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#a25c1bd959768a66ebfdc3c4995b128a2">_stm32f4_ultrasound_get</a> (uint32_t ultrasound_id)</td></tr>
<tr class="memdesc:a25c1bd959768a66ebfdc3c4995b128a2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the ultrasound struct with the given ID.  <a href="stm32f4__ultrasound_8c.html#a25c1bd959768a66ebfdc3c4995b128a2">More...</a><br /></td></tr>
<tr class="separator:a25c1bd959768a66ebfdc3c4995b128a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4c3b91c72ccc14205bff17fb07c8a58"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#ac4c3b91c72ccc14205bff17fb07c8a58">_timer_trigger_setup</a> ()</td></tr>
<tr class="memdesc:ac4c3b91c72ccc14205bff17fb07c8a58"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure the timer that controls the duration of the trigger signal.  <a href="stm32f4__ultrasound_8c.html#ac4c3b91c72ccc14205bff17fb07c8a58">More...</a><br /></td></tr>
<tr class="separator:ac4c3b91c72ccc14205bff17fb07c8a58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a1f78238258e444b4e7b3a2d42f445b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#a2a1f78238258e444b4e7b3a2d42f445b">_timer_echo_setup</a> (uint32_t ultrasound_id)</td></tr>
<tr class="memdesc:a2a1f78238258e444b4e7b3a2d42f445b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure the timer that controls the duration of the echo signal.  <a href="stm32f4__ultrasound_8c.html#a2a1f78238258e444b4e7b3a2d42f445b">More...</a><br /></td></tr>
<tr class="separator:a2a1f78238258e444b4e7b3a2d42f445b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a288d1d8f0fec4fa8ebcec4679e1c2d48"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#a288d1d8f0fec4fa8ebcec4679e1c2d48">_timer_new_measurement_setup</a> ()</td></tr>
<tr class="memdesc:a288d1d8f0fec4fa8ebcec4679e1c2d48"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure the timer that controls the duration of the new measurement.  <a href="stm32f4__ultrasound_8c.html#a288d1d8f0fec4fa8ebcec4679e1c2d48">More...</a><br /></td></tr>
<tr class="separator:a288d1d8f0fec4fa8ebcec4679e1c2d48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acfa7c7fa4ee94431efa746fceaf2a770"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#acfa7c7fa4ee94431efa746fceaf2a770">port_ultrasound_init</a> (uint32_t ultrasound_id)</td></tr>
<tr class="memdesc:acfa7c7fa4ee94431efa746fceaf2a770"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure the HW specifications of a given ultrasound sensor.  <a href="stm32f4__ultrasound_8c.html#acfa7c7fa4ee94431efa746fceaf2a770">More...</a><br /></td></tr>
<tr class="separator:acfa7c7fa4ee94431efa746fceaf2a770"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae567e86e69a1e7a150cb7044feae0d55"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#ae567e86e69a1e7a150cb7044feae0d55">port_ultrasound_start_measurement</a> (uint32_t ultrasound_id)</td></tr>
<tr class="memdesc:ae567e86e69a1e7a150cb7044feae0d55"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start a new measurement of the ultrasound sensor.  <a href="stm32f4__ultrasound_8c.html#ae567e86e69a1e7a150cb7044feae0d55">More...</a><br /></td></tr>
<tr class="separator:ae567e86e69a1e7a150cb7044feae0d55"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad359ec117f8b709a95dd81c1d31167f2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#ad359ec117f8b709a95dd81c1d31167f2">port_ultrasound_stop_trigger_timer</a> (uint32_t ultrasound_id)</td></tr>
<tr class="memdesc:ad359ec117f8b709a95dd81c1d31167f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop the timer that controls the trigger signal.  <a href="stm32f4__ultrasound_8c.html#ad359ec117f8b709a95dd81c1d31167f2">More...</a><br /></td></tr>
<tr class="separator:ad359ec117f8b709a95dd81c1d31167f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab634b73c4b5c25b55e6fb8c8ec45445"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#aab634b73c4b5c25b55e6fb8c8ec45445">port_ultrasound_stop_echo_timer</a> (uint32_t ultrasound_id)</td></tr>
<tr class="memdesc:aab634b73c4b5c25b55e6fb8c8ec45445"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop the timer that controls the echo signal.  <a href="stm32f4__ultrasound_8c.html#aab634b73c4b5c25b55e6fb8c8ec45445">More...</a><br /></td></tr>
<tr class="separator:aab634b73c4b5c25b55e6fb8c8ec45445"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90d426fefd1b7fead277685f1ba97d16"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#a90d426fefd1b7fead277685f1ba97d16">port_ultrasound_start_new_measurement_timer</a> ()</td></tr>
<tr class="memdesc:a90d426fefd1b7fead277685f1ba97d16"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start the timer that controls the new measurement.  <a href="stm32f4__ultrasound_8c.html#a90d426fefd1b7fead277685f1ba97d16">More...</a><br /></td></tr>
<tr class="separator:a90d426fefd1b7fead277685f1ba97d16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef2ce87e9dba405678eecbf46c9e11c7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#aef2ce87e9dba405678eecbf46c9e11c7">port_ultrasound_stop_new_measurement_timer</a> ()</td></tr>
<tr class="memdesc:aef2ce87e9dba405678eecbf46c9e11c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop the timer that controls the new measurement.  <a href="stm32f4__ultrasound_8c.html#aef2ce87e9dba405678eecbf46c9e11c7">More...</a><br /></td></tr>
<tr class="separator:aef2ce87e9dba405678eecbf46c9e11c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba9e7b923969aca6331b16832fbee4f8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#aba9e7b923969aca6331b16832fbee4f8">port_ultrasound_reset_echo_ticks</a> (uint32_t ultrasound_id)</td></tr>
<tr class="memdesc:aba9e7b923969aca6331b16832fbee4f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the time ticks of the echo signal.  <a href="stm32f4__ultrasound_8c.html#aba9e7b923969aca6331b16832fbee4f8">More...</a><br /></td></tr>
<tr class="separator:aba9e7b923969aca6331b16832fbee4f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6445d417d1b2390226787925d264d66"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#ae6445d417d1b2390226787925d264d66">port_ultrasound_stop_ultrasound</a> (uint32_t ultrasound_id)</td></tr>
<tr class="memdesc:ae6445d417d1b2390226787925d264d66"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop all the timers of the ultrasound sensor and reset the echo ticks.  <a href="stm32f4__ultrasound_8c.html#ae6445d417d1b2390226787925d264d66">More...</a><br /></td></tr>
<tr class="separator:ae6445d417d1b2390226787925d264d66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aece4bcd0e3feb83500b9b67510c1c863"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#aece4bcd0e3feb83500b9b67510c1c863">port_ultrasound_get_trigger_ready</a> (uint32_t ultrasound_id)</td></tr>
<tr class="memdesc:aece4bcd0e3feb83500b9b67510c1c863"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the readiness of the trigger signal.  <a href="stm32f4__ultrasound_8c.html#aece4bcd0e3feb83500b9b67510c1c863">More...</a><br /></td></tr>
<tr class="separator:aece4bcd0e3feb83500b9b67510c1c863"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae5b7c5a7e58b8498b58258ce9ae4e15"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#aae5b7c5a7e58b8498b58258ce9ae4e15">port_ultrasound_set_trigger_ready</a> (uint32_t ultrasound_id, bool trigger_ready)</td></tr>
<tr class="memdesc:aae5b7c5a7e58b8498b58258ce9ae4e15"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the readiness of the trigger signal.  <a href="stm32f4__ultrasound_8c.html#aae5b7c5a7e58b8498b58258ce9ae4e15">More...</a><br /></td></tr>
<tr class="separator:aae5b7c5a7e58b8498b58258ce9ae4e15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a959305daadc4d98a5208b41a1305316f"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#a959305daadc4d98a5208b41a1305316f">port_ultrasound_get_trigger_end</a> (uint32_t ultrasound_id)</td></tr>
<tr class="memdesc:a959305daadc4d98a5208b41a1305316f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the status of the trigger signal.  <a href="stm32f4__ultrasound_8c.html#a959305daadc4d98a5208b41a1305316f">More...</a><br /></td></tr>
<tr class="separator:a959305daadc4d98a5208b41a1305316f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28e921af96b431d832fd574ee90b3baa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#a28e921af96b431d832fd574ee90b3baa">port_ultrasound_set_trigger_end</a> (uint32_t ultrasound_id, bool trigger_end)</td></tr>
<tr class="memdesc:a28e921af96b431d832fd574ee90b3baa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the status of the trigger signal.  <a href="stm32f4__ultrasound_8c.html#a28e921af96b431d832fd574ee90b3baa">More...</a><br /></td></tr>
<tr class="separator:a28e921af96b431d832fd574ee90b3baa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a385214eef040dbd4a4d9b1939000d14b"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#a385214eef040dbd4a4d9b1939000d14b">port_ultrasound_get_echo_init_tick</a> (uint32_t ultrasound_id)</td></tr>
<tr class="memdesc:a385214eef040dbd4a4d9b1939000d14b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the time tick when the init of echo signal was received.  <a href="stm32f4__ultrasound_8c.html#a385214eef040dbd4a4d9b1939000d14b">More...</a><br /></td></tr>
<tr class="separator:a385214eef040dbd4a4d9b1939000d14b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ad08467d731e0f28da4e5a912cb0f1c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#a5ad08467d731e0f28da4e5a912cb0f1c">port_ultrasound_set_echo_init_tick</a> (uint32_t ultrasound_id, uint32_t echo_init_tick)</td></tr>
<tr class="memdesc:a5ad08467d731e0f28da4e5a912cb0f1c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the time tick when the init of echo signal was received.  <a href="stm32f4__ultrasound_8c.html#a5ad08467d731e0f28da4e5a912cb0f1c">More...</a><br /></td></tr>
<tr class="separator:a5ad08467d731e0f28da4e5a912cb0f1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fd8e4ff9c1aead8bbf9d63d4a132f0f"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#a3fd8e4ff9c1aead8bbf9d63d4a132f0f">port_ultrasound_get_echo_end_tick</a> (uint32_t ultrasound_id)</td></tr>
<tr class="memdesc:a3fd8e4ff9c1aead8bbf9d63d4a132f0f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the time tick when the end of echo signal was received.  <a href="stm32f4__ultrasound_8c.html#a3fd8e4ff9c1aead8bbf9d63d4a132f0f">More...</a><br /></td></tr>
<tr class="separator:a3fd8e4ff9c1aead8bbf9d63d4a132f0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49b6593a8cc519fe0506fab4886ba80e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#a49b6593a8cc519fe0506fab4886ba80e">port_ultrasound_set_echo_end_tick</a> (uint32_t ultrasound_id, uint32_t echo_end_tick)</td></tr>
<tr class="memdesc:a49b6593a8cc519fe0506fab4886ba80e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the time tick when the end of echo signal was received.  <a href="stm32f4__ultrasound_8c.html#a49b6593a8cc519fe0506fab4886ba80e">More...</a><br /></td></tr>
<tr class="separator:a49b6593a8cc519fe0506fab4886ba80e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fd9a038cc72fa00a6175f706be08bb3"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#a0fd9a038cc72fa00a6175f706be08bb3">port_ultrasound_get_echo_received</a> (uint32_t ultrasound_id)</td></tr>
<tr class="memdesc:a0fd9a038cc72fa00a6175f706be08bb3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the status of the echo signal.  <a href="stm32f4__ultrasound_8c.html#a0fd9a038cc72fa00a6175f706be08bb3">More...</a><br /></td></tr>
<tr class="separator:a0fd9a038cc72fa00a6175f706be08bb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fd228b710f1b73e28fbdb7c67a35d0a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#a7fd228b710f1b73e28fbdb7c67a35d0a">port_ultrasound_set_echo_received</a> (uint32_t ultrasound_id, bool echo_received)</td></tr>
<tr class="memdesc:a7fd228b710f1b73e28fbdb7c67a35d0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the status of the echo signal.  <a href="stm32f4__ultrasound_8c.html#a7fd228b710f1b73e28fbdb7c67a35d0a">More...</a><br /></td></tr>
<tr class="separator:a7fd228b710f1b73e28fbdb7c67a35d0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d21bece407596a4e345734a65490983"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#a2d21bece407596a4e345734a65490983">port_ultrasound_get_echo_overflows</a> (uint32_t ultrasound_id)</td></tr>
<tr class="memdesc:a2d21bece407596a4e345734a65490983"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the number of overflows of the echo signal timer.  <a href="stm32f4__ultrasound_8c.html#a2d21bece407596a4e345734a65490983">More...</a><br /></td></tr>
<tr class="separator:a2d21bece407596a4e345734a65490983"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c1fa21bfaacc552d9c3d38b05db217d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#a3c1fa21bfaacc552d9c3d38b05db217d">port_ultrasound_set_echo_overflows</a> (uint32_t ultrasound_id, uint32_t echo_overflows)</td></tr>
<tr class="memdesc:a3c1fa21bfaacc552d9c3d38b05db217d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the number of overflows of the echo signal timer.  <a href="stm32f4__ultrasound_8c.html#a3c1fa21bfaacc552d9c3d38b05db217d">More...</a><br /></td></tr>
<tr class="separator:a3c1fa21bfaacc552d9c3d38b05db217d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac57a3d65d27792e2949367fffd46627"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#aac57a3d65d27792e2949367fffd46627">stm32f4_ultrasound_set_new_trigger_gpio</a> (uint32_t ultrasound_id, GPIO_TypeDef *p_port, uint8_t pin)</td></tr>
<tr class="memdesc:aac57a3d65d27792e2949367fffd46627"><td class="mdescLeft">&#160;</td><td class="mdescRight">Auxiliary function to change the GPIO and pin of the trigger pin of an ultrasound transceiver. This function is used for testing purposes mainly although it can be used in the final implementation if needed.  <a href="stm32f4__ultrasound_8c.html#aac57a3d65d27792e2949367fffd46627">More...</a><br /></td></tr>
<tr class="separator:aac57a3d65d27792e2949367fffd46627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab2d00832e8d089dbc740ccb37880ffc2"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structstm32f4__ultrasound__hw__t.html">stm32f4_ultrasound_hw_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stm32f4__ultrasound_8c.html#ab2d00832e8d089dbc740ccb37880ffc2">ultrasounds_arr</a> []</td></tr>
<tr class="memdesc:ab2d00832e8d089dbc740ccb37880ffc2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Array of elements that represents the HW characteristics of the ultrasounds connected to the STM32F4 platform.  <a href="stm32f4__ultrasound_8c.html#ab2d00832e8d089dbc740ccb37880ffc2">More...</a><br /></td></tr>
<tr class="separator:ab2d00832e8d089dbc740ccb37880ffc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Portable functions to interact with the ultrasound FSM library. All portable functions must be implemented in this file. </p>
<dl class="section author"><dt>Author</dt><dd>Sistemas Digitales II </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2025-01-01 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a25c1bd959768a66ebfdc3c4995b128a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25c1bd959768a66ebfdc3c4995b128a2">&#9670;&nbsp;</a></span>_stm32f4_ultrasound_get()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structstm32f4__ultrasound__hw__t.html">stm32f4_ultrasound_hw_t</a>* _stm32f4_ultrasound_get </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the ultrasound struct with the given ID. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to the ultrasound struct. </dd>
<dd>
NULL If the ultrasound ID is not valid. </dd></dl>

</div>
</div>
<a id="a2a1f78238258e444b4e7b3a2d42f445b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a1f78238258e444b4e7b3a2d42f445b">&#9670;&nbsp;</a></span>_timer_echo_setup()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void _timer_echo_setup </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Configure the timer that controls the duration of the echo signal. </p>
<p>This function configures the timer as input capture to measure the duration of the echo signal. <code><a class="el" href="stm32f4__ultrasound_8c.html#acfa7c7fa4ee94431efa746fceaf2a770" title="Configure the HW specifications of a given ultrasound sensor.">port_ultrasound_init()</a></code> public function to configure the timer.</p>
<p><b>Follow the example of the section <code>Ejemplo: captura de entrada (input capture)</code> of the <code>Libro de Fundamentos</code> to configure the timer as input capture.</b></p>
<p><b>Use the timer indicated in the <a href="index.html">main page</a>.</b></p>
<dl class="section warning"><dt>Warning</dt><dd>The timer that controls the echo signal is specific for each ultrasound sensor and must be configured separately (within a conditional statement). Use the ultrasound ID to select the correct timer.</dd></dl>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Enable the clock of the timer that controls the echo signal. Check the reference manual of the STM32F4 to know if the timer is connected to the APB1 or APB2 bus (i.e. <code>RCC-&gt;APB1ENR</code> or <code>RCC-&gt;APB2ENR</code>). <br  />
✅ 2. Set the values of the prescaler and the auto-reload registers. Configure PSC for a resolution of 1 us (1 MHz) and ARR high enough to avoid too many overflows, e.g. it maximum value. <br  />
✅ 3. Set the auto-reload preload bit (ARPE) in the control register (CR1) to enable the auto-reload register. Also enable the update generation bit (UG) in the event generation register (EGR) to force the update of the registers. <br  />
✅ 4. Set the direction as input in the Capture/Compare mode register (CCMRx). <code>x</code> is 1 for channels 1 and 2, and 2 for channels 3 and 4. Check the table "Table 11. Alternate function" in the datasheet to identify the channel related to timer associated to the pin of the echo signal. <br  />
 ✅ 5. Disable digital filtering by clearing the ICxF bits in the Capture/Compare mode register (CCMRx). <br  />
✅ 6. Select the edge of the active transition in the Capture/Compare enable register (CCER). Set the bits CCxNP and CCxP to detect both rising and falling edges. <br  />
✅ 7. Program the input prescaler to capture each valid transition. Set the ICxPSC bits in the Capture/Compare mode register (CCMRx) to 0. <br  />
✅ 8. Enable the Capture/compare enable register (CCER) for the corresponding channel. <br  />
✅ 9. Enable the Capture/Compare interrupts bit (CCxIE) for the corresponding channel in the DMA/interrupt enable register (DIER). <br  />
✅ 10. Enable the update interrupt bit (UIE) in the DMA/interrupt enable register (DIER). <br  />
✅ 11. Set the priority of the timer interrupt in the NVIC using the <code>NVIC_SetPriority()</code> function and the <code>TIMx_IRQn</code> interrupt with the level of priority and sub-priority shown in the <a href="index.html">main page</a>. <br  />
</p>
</blockquote>
<dl class="section note"><dt>Note</dt><dd><b>Do not enable the timer yet</b>. This will be done when the trigger signal must be sent. <b>Do not enable the timer interrupt yet</b>. This will be done when the trigger signal must be sent.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This ID is used to configure the timer that controls the echo signal of the ultrasound sensor. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a288d1d8f0fec4fa8ebcec4679e1c2d48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a288d1d8f0fec4fa8ebcec4679e1c2d48">&#9670;&nbsp;</a></span>_timer_new_measurement_setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void _timer_new_measurement_setup </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configure the timer that controls the duration of the new measurement. </p>
<p>This function configures the timer to generate an internal interrupt to control the duration of a measurement. The duration of a measurement is defined in the <code>PORT_PARKING_SENSOR_TIMEOUT_MS</code> macro. This function is called by the <code><a class="el" href="stm32f4__ultrasound_8c.html#acfa7c7fa4ee94431efa746fceaf2a770" title="Configure the HW specifications of a given ultrasound sensor.">port_ultrasound_init()</a></code> public function to configure the timer that controls the duration of the new measurement.</p>
<p><b>Use the timer indicated in the <a href="index.html">main page</a>.</b></p>
<dl class="section warning"><dt>Warning</dt><dd>The timer that controls the new measurement is common for all the ultrasound sensors and must be configured only once. Use the ultrasound ID to select the correct timer.</dd></dl>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Follow the same steps as in the <code><a class="el" href="stm32f4__ultrasound_8c.html#ac4c3b91c72ccc14205bff17fb07c8a58" title="Configure the timer that controls the duration of the trigger signal.">_timer_trigger_setup()</a></code> function to configure the timer that controls the duration of the new measurement. <br  />
</p>
</blockquote>
<dl class="section note"><dt>Note</dt><dd>Do not enable the timer yet. This will be done when the trigger signal must be sent. Do not enable the timer interrupt yet. This will be done when the trigger signal must be sent. </dd></dl>

</div>
</div>
<a id="ac4c3b91c72ccc14205bff17fb07c8a58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4c3b91c72ccc14205bff17fb07c8a58">&#9670;&nbsp;</a></span>_timer_trigger_setup()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void _timer_trigger_setup </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Configure the timer that controls the duration of the trigger signal. </p>
<p>This function configures the timer to generate internal interrupts to control the raise and fall of the trigger signal. The duration of the trigger signal is defined in the <code>PORT_PARKING_SENSOR_TRIGGER_UP_US</code> macro. This function is called by the <code><a class="el" href="stm32f4__ultrasound_8c.html#acfa7c7fa4ee94431efa746fceaf2a770" title="Configure the HW specifications of a given ultrasound sensor.">port_ultrasound_init()</a></code> public function to configure the timer that controls the duration of the trigger signal.</p>
<p><b>Use the timer indicated in the <a href="index.html">main page</a>.</b></p>
<p><b>There are 2 ways to calculate the <code>ARR</code> and <code>PSC</code> values.</b> You can implement any of them to configure the timer duration according to the <code>PORT_PARKING_SENSOR_TRIGGER_UP_US</code> macro. <b>Do not set the values directly!</b></p>
<p><b>Option 1. Efficient algorithm.</b> <br  />
This option is the most efficient way to calculate the <code>ARR</code> and <code>PSC</code> values. It is based on the fact that the <code>ARR</code> value is near or equal to its maximum value (65535.0). And only one update of the <code>PSC</code> is needed. This eliminates the need for a loop, which could be slow if <code>ARR</code> is much larger than 0xFFFF. <br  />
<br  />
<b>Option 2. Iterative algorithm.</b> <br  />
This option, on the other hand, starts with <code>PSC</code> equals <code>0</code> and re-computes in an iterative loop the values of <code>ARR</code> and <code>PSC</code>. ⚠️ <b>WARNING! This option is not recommended. You should consider that this option is much slower than the efficient algorithm and this option will make the <code>test_port_ultrasound</code> take a long time to execute (several seconds up to few minutes).</b> <br  />
 </p><dl class="section warning"><dt>Warning</dt><dd>It is important to <b>work with double type numbers to avoid the loss of precision</b> when computing the temporary values of the <code>ARR</code> and <code>PSC</code> registers. The <code>math.h</code> library is included to use the <code>round()</code> function. <br  />
To store the temporary values of the <code>ARR</code> and <code>PSC</code> registers, <b>cast the result of the <code>round()</code> function to <code>uint32_t</code></b>. <br  />
<b>All the values must be represented as double in the formulas.</b> <br  />
An arbitrary example of C code: <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line">...</div>
<div class="line">double sysclk_as_double = (double)<a class="code" href="stm32f4__system_8c.html#aa3cd3e43291e81e795d642b79b6088e6">SystemCoreClock</a>; <span class="comment">// Important to cast to double</span></div>
<div class="line"><span class="keywordtype">double</span> ms_as_double = (double)duration_ms; <span class="comment">// Important to cast to double</span></div>
<div class="line"><span class="keywordtype">double</span> what_ever_value = (sysclk_as_double / ms_as_double) + 1.0; <span class="comment">// Important to use 1.0 instead of 1!!! This formula is just an example!!!</span></div>
<div class="line">TIMx-&gt;ARR = (uint32_t)(round(what_ever_value)); <span class="comment">// Important to round before casting to uint32_t</span></div>
</div><!-- fragment --></dd></dl>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Enable the clock of the timer that controls the trigger signal. Check the reference manual of the STM32F4 to know if the timer is connected to the APB1 or APB2 bus (i.e. <code>RCC-&gt;APB1ENR</code> or <code>RCC-&gt;APB2ENR</code>). <br  />
✅ 2. Disable the counter of the timer (register <code>CR1</code> of the timer) because we want to configure it. <br  />
✅ 3. Enable the autoreload preload (bit <code>ARPE</code> of the register <code>CR1</code>) to enable the autoreload register. <br  />
✅ 4. Set the counter of the timer to 0 (register <code>CNT</code>) to start counting from 0. <br  />
✅ 5. Compute the prescaler and the auto-reload register to set the duration of the trigger signal. The duration of the trigger signal is defined in the <code>PORT_PARKING_SENSOR_TRIGGER_UP_US</code> macro. Use any of the two options to calculate the <code>ARR</code> and <code>PSC</code> values:</p>
<p><b>Option 1. Efficient algorithm.</b> <br  />
&#160;&#160;&#160;&#160; ➡️ <b>6a</b>. Convert <code>SystemCoreClock</code> to double and store them in local variables. This is to ensure that the subsequent calculations are performed in floating-point arithmetic. <br  />
&#160;&#160;&#160;&#160; ➡️ <b>6b</b>. Compute an initial value for the <code>PSC</code> register considering the maximum value of <code>ARR</code> (65535.0). Store it in a local variable of type <code>double</code>. <br  />
&#160;&#160;&#160;&#160;💡 Use all variable and numbers as <code>double</code> (i.e., use 1.0 instead of 1). <br  />
 &#160;&#160;&#160;&#160;💡 Use the function <code>round()</code> from the <code>math.h</code> library to round the value of the <code>PSC</code>. Use round instead of casting to <code>double</code>, because casting trunks the decimal value. <br  />
&#160;&#160;&#160;&#160; ➡️ <b>6c</b>. Re-compute the value of the <code>ARR</code> register with the previously computed <code>PSC</code> value. Store it in a local variable of type <code>double</code>. <br  />
&#160;&#160;&#160;&#160;💡 This would make <code>ARR</code> less than or equal to 65535.0, and we will adjust <code>ARR</code> and <code>PSC</code> if necessary. This eliminates the need for a loop, which could be slow if <code>ARR</code> is much larger than 0xFFFF. <br  />
&#160;&#160;&#160;&#160;💡 Use the function <code>round()</code> to round the value of the <code>ARR</code>. <br  />
&#160;&#160;&#160;&#160; ➡️ <b>6d</b>. Check if the new value of <code>ARR</code> is greater than 0xFFFF (or 65535.0). If it is, increment <code>PSC</code> by 1.0 and recalculate <code>ARR</code>. This is to ensure that <code>ARR</code> does not exceed 0xFFFF. <br  />
&#160;&#160;&#160;&#160;💡 Because the re-computed value of <code>ARR</code> will be close to its maximum, adding 1.0 to the <code>PSC</code> is enough to ensure that the <code>ARR</code> does not exceeds it maximum value and we do not need to iterate over it, making this algorithm faster than using a <code>while(){}</code> loop. <br  />
&#160;&#160;&#160;&#160; ➡️ <b>6e</b>. Continue in ✅ 7. <br  />
<br  />
 <br  />
<b>Option 2. Iterative algorithm.</b> <br  />
&#160;&#160;&#160;&#160; ➡️ <b>6a</b>. Convert <code>SystemCoreClock</code> to double and store them in local variables. This is to ensure that the subsequent calculations are performed in floating-point arithmetic. <br  />
&#160;&#160;&#160;&#160; ➡️ <b>6b</b>. Compute an initial value for the <code>ARR</code> register considering a minimum value of <code>PSC</code> (0.0). Store it in a local variable of type <code>double</code>. <br  />
&#160;&#160;&#160;&#160;&#160;&#160;💡 Use all variable and numbers as <code>double</code> (i.e., use 1.0 instead of 1). <br  />
&#160;&#160;&#160;&#160;&#160;&#160;💡 Use the function <code>round()</code> from the <code>math.h</code> library to round the value of the <code>ARR</code>. Use round instead of casting to <code>double</code>, because casting trunks the decimal value. <br  />
&#160;&#160;&#160;&#160; ➡️ <b>6c</b>. If the value of <code>ARR</code> is greater than 0xFFFF (or 65535.0), increment the <code>PSC</code> by 1.0 and recalculate <code>ARR</code>. This is to ensure that <code>ARR</code> does not exceed 0xFFFF. <br  />
&#160;&#160;&#160;&#160; ➡️ <b>6d</b>. Do this in an iterative <code>while(){}</code> loop. <br  />
&#160;&#160;&#160;&#160; ➡️ <b>6e</b>. Continue in ✅ 7. <br  />
<br  />
✅ 6. Load the values computed for <code>ARR</code> and <code>PSC</code> into the corresponding registers of the timer. <br  />
&#160;&#160;&#160;&#160;💡 Ensure that values are rounded before casting. <br  />
✅ 7. The <code>PSC</code> and <code>ARR</code> values are currently in the preload registers. To load them into the active registers we need an update event. We achieve this by setting the <code>UG</code> bit of the <code>EGR</code> register. It is important to do this at the end of the configuration of the timer. <br  />
✅ 8. Clear the update interrupt flag (bit <code>UIF</code> of the register <code>SR</code>) to avoid an unwanted interrupt. <br  />
 ✅ 9. Enable the interrupts of the timer by setting the <code>UIE</code> bit of the <code>DIER</code> register. <br  />
✅ 10. Set the priority of the timer interrupt in the NVIC using the <code>NVIC_SetPriority()</code> function and the <code>TIMx_IRQn</code> interrupt with the level of priority and sub-priority shown in the <a href="index.html">main page</a>. <b>Do not enable the timer interrupt yet. This will be done when the trigger signal must be sent.</b> <br  />
</p>
</blockquote>
<dl class="section note"><dt>Note</dt><dd>Do not enable the timer yet. This will be done when the trigger signal must be sent. </dd></dl>

</div>
</div>
<a id="a3fd8e4ff9c1aead8bbf9d63d4a132f0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3fd8e4ff9c1aead8bbf9d63d4a132f0f">&#9670;&nbsp;</a></span>port_ultrasound_get_echo_end_tick()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t port_ultrasound_get_echo_end_tick </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the time tick when the end of echo signal was received. </p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Return the value of the field <code>echo_end_tick</code>. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This index is used to select the element of the <code>ultrasound_arr[]</code> array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>uint32_t </dd></dl>

</div>
</div>
<a id="a385214eef040dbd4a4d9b1939000d14b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a385214eef040dbd4a4d9b1939000d14b">&#9670;&nbsp;</a></span>port_ultrasound_get_echo_init_tick()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t port_ultrasound_get_echo_init_tick </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the time tick when the init of echo signal was received. </p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Return the value of the field <code>echo_init_tick</code>. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This index is used to select the element of the <code>ultrasound_arr[]</code> array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>uint32_t </dd></dl>

</div>
</div>
<a id="a2d21bece407596a4e345734a65490983"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d21bece407596a4e345734a65490983">&#9670;&nbsp;</a></span>port_ultrasound_get_echo_overflows()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t port_ultrasound_get_echo_overflows </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the number of overflows of the echo signal timer. </p>
<p>This function returns the number of overflows of the echo signal timer. It is used to calculate the real time elapsed in the echo signal.</p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Return the value of the field <code>echo_overflows</code>. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This index is used to select the element of the <code>ultrasound_arr[]</code> array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>uint32_t </dd></dl>

</div>
</div>
<a id="a0fd9a038cc72fa00a6175f706be08bb3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0fd9a038cc72fa00a6175f706be08bb3">&#9670;&nbsp;</a></span>port_ultrasound_get_echo_received()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool port_ultrasound_get_echo_received </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the status of the echo signal. </p>
<p>This function returns the status of the echo signal. It will be <code>true</code> if the echo signal has been received (both the init and end ticks).</p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Return the value of the field <code>echo_received</code>. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This index is used to select the element of the <code>ultrasound_arr[]</code> array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true </dd>
<dd>
false </dd></dl>

</div>
</div>
<a id="a959305daadc4d98a5208b41a1305316f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a959305daadc4d98a5208b41a1305316f">&#9670;&nbsp;</a></span>port_ultrasound_get_trigger_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool port_ultrasound_get_trigger_end </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the status of the trigger signal. </p>
<p>This function returns the status of the trigger signal. It will be <code>true</code> if the time to trigger the ultrasound sensor has finished. <br  />
 </p><blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Return the value of the field <code>trigger_end</code>. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This index is used to select the element of the <code>ultrasound_arr[]</code> array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true </dd>
<dd>
false </dd></dl>

</div>
</div>
<a id="aece4bcd0e3feb83500b9b67510c1c863"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aece4bcd0e3feb83500b9b67510c1c863">&#9670;&nbsp;</a></span>port_ultrasound_get_trigger_ready()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool port_ultrasound_get_trigger_ready </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the readiness of the trigger signal. </p>
<p>This function returns the status of readiness the trigger signal. If it is true, the ultrasound sensor is ready to start a new measurement.</p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Return the value of the field <code>trigger_ready</code>. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This index is used to select the element of the <code>ultrasound_arr[]</code> array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true </dd>
<dd>
false </dd></dl>

</div>
</div>
<a id="acfa7c7fa4ee94431efa746fceaf2a770"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acfa7c7fa4ee94431efa746fceaf2a770">&#9670;&nbsp;</a></span>port_ultrasound_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void port_ultrasound_init </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configure the HW specifications of a given ultrasound sensor. </p>
<p>Assuming we are using an STM32F4-based platform, this function must call the following functions:</p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Initialize the fields of the ultrasound struct. Set the variables related to ticks to 0 and the flags to false but the trigger_ready to true. <br  />
✅ 2. Configure the trigger pin as output and no pull up neither pull down connection. <br  />
✅ 3. Configure the echo pin as alternate function and no pull up neither pull down connection. <br  />
✅ 4. Configure the alternate function of the echo pin. <br  />
✅ 5. Call the 3 private functions that configure the timers of the trigger, echo and new measurement. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This index is used to select the element of the <code>ultrasound_arr[]</code> array </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aba9e7b923969aca6331b16832fbee4f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba9e7b923969aca6331b16832fbee4f8">&#9670;&nbsp;</a></span>port_ultrasound_reset_echo_ticks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void port_ultrasound_reset_echo_ticks </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset the time ticks of the echo signal. </p>
<p>This function resets the time ticks of the echo signal once the distance has been calculated.</p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Reset the time ticks of the echo signal. Also, reset the flag <code>echo_received</code>. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This index is used to select the element of the <code>ultrasound_arr[]</code> array </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a49b6593a8cc519fe0506fab4886ba80e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a49b6593a8cc519fe0506fab4886ba80e">&#9670;&nbsp;</a></span>port_ultrasound_set_echo_end_tick()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void port_ultrasound_set_echo_end_tick </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>echo_end_tick</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the time tick when the end of echo signal was received. </p>
<p>This function sets the time tick when the end of echo signal was received. It is called by the ISR of the input capture of the echo signal.</p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Set the value of the field <code>echo_end_tick</code> with the received value. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This index is used to select the element of the <code>ultrasound_arr[]</code> array </td></tr>
    <tr><td class="paramname">echo_end_tick</td><td>Time tick when the end of echo signal was received. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a5ad08467d731e0f28da4e5a912cb0f1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ad08467d731e0f28da4e5a912cb0f1c">&#9670;&nbsp;</a></span>port_ultrasound_set_echo_init_tick()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void port_ultrasound_set_echo_init_tick </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>echo_init_tick</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the time tick when the init of echo signal was received. </p>
<p>This function sets the time tick when the init of echo signal was received. It is called by the ISR of the input capture of the echo signal.</p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Set the value of the field <code>echo_init_tick</code> with the received value. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This index is used to select the element of the <code>ultrasound_arr[]</code> array </td></tr>
    <tr><td class="paramname">echo_init_tick</td><td>Time tick when the init of echo signal was received. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a3c1fa21bfaacc552d9c3d38b05db217d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c1fa21bfaacc552d9c3d38b05db217d">&#9670;&nbsp;</a></span>port_ultrasound_set_echo_overflows()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void port_ultrasound_set_echo_overflows </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>echo_overflows</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the number of overflows of the echo signal timer. </p>
<p>This function sets the number of overflows of the echo signal timer. It is called by the ISR of the input capture of the echo signal when an overflow occurs to increment the number of overflows.</p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Set the value of the field <code>echo_overflows</code> with the received value. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This index is used to select the element of the <code>ultrasound_arr[]</code> array </td></tr>
    <tr><td class="paramname">echo_overflows</td><td>Number of overflows of the echo signal timer. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a7fd228b710f1b73e28fbdb7c67a35d0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7fd228b710f1b73e28fbdb7c67a35d0a">&#9670;&nbsp;</a></span>port_ultrasound_set_echo_received()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void port_ultrasound_set_echo_received </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>echo_received</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the status of the echo signal. </p>
<p>This function sets the status of the echo signal. The ISR of the input capture of the echo signal calls this function to set the status of the echo signal when both the init and end ticks have been received.</p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Set the value of the field <code>echo_received</code> with the received value. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This index is used to select the element of the <code>ultrasound_arr[]</code> array </td></tr>
    <tr><td class="paramname">echo_received</td><td>Status of the echo signal. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a28e921af96b431d832fd574ee90b3baa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28e921af96b431d832fd574ee90b3baa">&#9670;&nbsp;</a></span>port_ultrasound_set_trigger_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void port_ultrasound_set_trigger_end </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>trigger_end</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the status of the trigger signal. </p>
<p>This function sets the status of the trigger signal. It will be <code>true</code> to indicate that the time to trigger the ultrasound sensor has finished and the trigger signal is low.</p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Set the value of the field <code>trigger_end</code> with the received value. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This index is used to select the element of the <code>ultrasound_arr[]</code> array </td></tr>
    <tr><td class="paramname">trigger_end</td><td>Status of the trigger signal. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aae5b7c5a7e58b8498b58258ce9ae4e15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae5b7c5a7e58b8498b58258ce9ae4e15">&#9670;&nbsp;</a></span>port_ultrasound_set_trigger_ready()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void port_ultrasound_set_trigger_ready </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>trigger_ready</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the readiness of the trigger signal. </p>
<p>This function sets the status of readiness of the trigger signal. If it is true, the ultrasound sensor will ready to start a new measurement.</p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Set the value of the field <code>trigger_ready</code> with the received value. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This index is used to select the element of the <code>ultrasound_arr[]</code> array </td></tr>
    <tr><td class="paramname">trigger_ready</td><td>Status of the trigger signal. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ae567e86e69a1e7a150cb7044feae0d55"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae567e86e69a1e7a150cb7044feae0d55">&#9670;&nbsp;</a></span>port_ultrasound_start_measurement()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void port_ultrasound_start_measurement </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start a new measurement of the ultrasound sensor. </p>
<p>This function prepares the timer of the trigger and the timer of the echo signal to start a new measurement. It also enables the timer that controls the new measurement.</p>
<dl class="section warning"><dt>Warning</dt><dd>The timer that controls the time of a new measurement is common for all the ultrasound sensors in the system, but the timers that controls the trigger and echo signal are specific for each ultrasound sensor and must be configured separately (within a conditional statement).</dd></dl>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Reset the flag <code>trigger_ready</code> to indicate that a new measurement has started. <br  />
✅ 2. Reset the counters (<code>CNT</code>) of the trigger timer, the echo timer, and the new measurement timer. Enclose the configuration of the trigger and echo timers within a conditional statement. <br  />
✅ 3. Set the trigger pin to high. You can use the <code>BSRR</code> or call the <code><a class="el" href="stm32f4__system_8h.html#af46cdd939024e157ed6f7468edaee4e3" title="Write a digital value in a GPIO atomically.">stm32f4_system_gpio_write()</a></code> function. <br  />
✅ 4. Enable the timers interrupts in the NVIC using the <code>NVIC_EnableIRQ()</code> function and the <code>TIMx_IRQn</code> interrupts. <br  />
 ✅ 5. Enable the timers of the new measurement, the trigger timer, and the echo timer (register <code>CR1</code> of the timers). Enclose the configuration of the trigger and echo timer within a conditional statement. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This index is used to select the element of the <code>ultrasound_arr[]</code> array </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a90d426fefd1b7fead277685f1ba97d16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90d426fefd1b7fead277685f1ba97d16">&#9670;&nbsp;</a></span>port_ultrasound_start_new_measurement_timer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void port_ultrasound_start_new_measurement_timer </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start the timer that controls the new measurement. </p>
<p>This function starts the timer that controls the new measurement.</p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Enable the interrupt of the new measurement timer in the NVIC. <br  />
✅ 2. Enable the new measurement timer (register <code>CR1</code> of the timer). <br  />
</p>
</blockquote>

</div>
</div>
<a id="aab634b73c4b5c25b55e6fb8c8ec45445"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab634b73c4b5c25b55e6fb8c8ec45445">&#9670;&nbsp;</a></span>port_ultrasound_stop_echo_timer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void port_ultrasound_stop_echo_timer </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stop the timer that controls the echo signal. </p>
<p>This function stops the timer that controls the echo signal because the echo signal has been received.</p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Disable the echo timer (register <code>CR1</code> of the timer). Enclose the configuration of the echo timer within a conditional statement. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This index is used to select the element of the <code>ultrasound_arr[]</code> array </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aef2ce87e9dba405678eecbf46c9e11c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef2ce87e9dba405678eecbf46c9e11c7">&#9670;&nbsp;</a></span>port_ultrasound_stop_new_measurement_timer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void port_ultrasound_stop_new_measurement_timer </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stop the timer that controls the new measurement. </p>
<p>This function stops the timer that controls the new measurement.</p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Disable the new measurement timer (register <code>CR1</code> of the timer). <br  />
</p>
</blockquote>

</div>
</div>
<a id="ad359ec117f8b709a95dd81c1d31167f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad359ec117f8b709a95dd81c1d31167f2">&#9670;&nbsp;</a></span>port_ultrasound_stop_trigger_timer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void port_ultrasound_stop_trigger_timer </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stop the timer that controls the trigger signal. </p>
<p>This function stops the timer that controls the trigger signal because the time to trigger the ultrasound sensor has finished. It also sets the trigger signal to low.</p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Set the trigger pin to low. You can use the <code>BSRR</code> or call the <code><a class="el" href="stm32f4__system_8h.html#af46cdd939024e157ed6f7468edaee4e3" title="Write a digital value in a GPIO atomically.">stm32f4_system_gpio_write()</a></code> function. <br  />
✅ 2. Disable the trigger timer (register <code>CR1</code> of the timer). Enclose the configuration of the echo timer within a conditional statement. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>Ultrasound ID. This index is used to select the element of the <code>ultrasound_arr[]</code> array </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ae6445d417d1b2390226787925d264d66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6445d417d1b2390226787925d264d66">&#9670;&nbsp;</a></span>port_ultrasound_stop_ultrasound()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void port_ultrasound_stop_ultrasound </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stop all the timers of the ultrasound sensor and reset the echo ticks. </p>
<p>This function calls the functions to stop the trigger and echo timers and to reset the echo ticks.</p>
<blockquote class="doxtable">
<p><b>TODO alumnos:</b></p>
<p>✅ 1. Call all the 4 functions to stop the trigger timer, the echo timer, the new measurement timer, and to reset the echo ticks. <br  />
</p>
</blockquote>

</div>
</div>
<a id="aac57a3d65d27792e2949367fffd46627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac57a3d65d27792e2949367fffd46627">&#9670;&nbsp;</a></span>stm32f4_ultrasound_set_new_trigger_gpio()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stm32f4_ultrasound_set_new_trigger_gpio </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ultrasound_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GPIO_TypeDef *&#160;</td>
          <td class="paramname"><em>p_port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>pin</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Auxiliary function to change the GPIO and pin of the trigger pin of an ultrasound transceiver. This function is used for testing purposes mainly although it can be used in the final implementation if needed. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ultrasound_id</td><td>ID of the trigger signal to change. </td></tr>
    <tr><td class="paramname">p_port</td><td>New GPIO port for the trigger signal. </td></tr>
    <tr><td class="paramname">pin</td><td>New GPIO pin for the trigger signal. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ab2d00832e8d089dbc740ccb37880ffc2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2d00832e8d089dbc740ccb37880ffc2">&#9670;&nbsp;</a></span>ultrasounds_arr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structstm32f4__ultrasound__hw__t.html">stm32f4_ultrasound_hw_t</a> ultrasounds_arr[]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Array of elements that represents the HW characteristics of the ultrasounds connected to the STM32F4 platform. </p>
<p>This must be hidden from the user, so it is declared as static. To access the elements of this array, use the function <code><a class="el" href="stm32f4__ultrasound_8c.html#a25c1bd959768a66ebfdc3c4995b128a2" title="Get the ultrasound struct with the given ID.">_stm32f4_ultrasound_get()</a></code>. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="astm32f4__system_8c_html_aa3cd3e43291e81e795d642b79b6088e6"><div class="ttname"><a href="stm32f4__system_8c.html#aa3cd3e43291e81e795d642b79b6088e6">SystemCoreClock</a></div><div class="ttdeci">uint32_t SystemCoreClock</div><div class="ttdef"><b>Definition:</b> stm32f4_system.c:40</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_651562d8bf6cfd3e81eff5b570d7df50.html">port</a></li><li class="navelem"><a class="el" href="dir_aff93352f483d815f4aad2ce8569e33b.html">stm32f4</a></li><li class="navelem"><a class="el" href="dir_96ea3e7ce74ccff9e7229beeb516906f.html">src</a></li><li class="navelem"><a class="el" href="stm32f4__ultrasound_8c.html">stm32f4_ultrasound.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
