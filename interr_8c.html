<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Urbanite: Parking aid system: port/stm32f4/src/interr.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Urbanite: Parking aid system
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('interr_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">interr.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Interrupt service routines for the STM32F4 platform.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="port__system_8h.html">port_system.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="stm32f4__system_8h.html">stm32f4_system.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="port__button_8h.html">port_button.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="port__ultrasound_8h.html">port_ultrasound.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="stm32f4__button_8h.html">stm32f4_button.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="stm32f4__ultrasound_8h.html">stm32f4_ultrasound.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae7ee340978f5c25f52f0cad1457c6616"><td class="memItemLeft" align="right" valign="top"><a id="ae7ee340978f5c25f52f0cad1457c6616"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>Reset_Handler</b> (void)</td></tr>
<tr class="separator:ae7ee340978f5c25f52f0cad1457c6616"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5e09814056d617c521549e542639b7e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interr_8c.html#ab5e09814056d617c521549e542639b7e">SysTick_Handler</a> (void)</td></tr>
<tr class="memdesc:ab5e09814056d617c521549e542639b7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interrupt service routine for the System tick timer (SysTick).  <a href="interr_8c.html#ab5e09814056d617c521549e542639b7e">More...</a><br /></td></tr>
<tr class="separator:ab5e09814056d617c521549e542639b7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a738473a5b43f6c92b80ce1d3d6f77ed9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interr_8c.html#a738473a5b43f6c92b80ce1d3d6f77ed9">EXTI15_10_IRQHandler</a> (void)</td></tr>
<tr class="memdesc:a738473a5b43f6c92b80ce1d3d6f77ed9"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function handles Px10-Px15 global interrupts.  <a href="interr_8c.html#a738473a5b43f6c92b80ce1d3d6f77ed9">More...</a><br /></td></tr>
<tr class="separator:a738473a5b43f6c92b80ce1d3d6f77ed9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38ad4725462bdc5e86c4ead4f04b9fc2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interr_8c.html#a38ad4725462bdc5e86c4ead4f04b9fc2">TIM2_IRQHandler</a> (void)</td></tr>
<tr class="memdesc:a38ad4725462bdc5e86c4ead4f04b9fc2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interrupt service routine for the TIM2 timer.  <a href="interr_8c.html#a38ad4725462bdc5e86c4ead4f04b9fc2">More...</a><br /></td></tr>
<tr class="separator:a38ad4725462bdc5e86c4ead4f04b9fc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8e51d2183b5230cbd5481f8867adce9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interr_8c.html#ac8e51d2183b5230cbd5481f8867adce9">TIM3_IRQHandler</a> (void)</td></tr>
<tr class="memdesc:ac8e51d2183b5230cbd5481f8867adce9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interrupt service routine for the TIM3 timer.  <a href="interr_8c.html#ac8e51d2183b5230cbd5481f8867adce9">More...</a><br /></td></tr>
<tr class="separator:ac8e51d2183b5230cbd5481f8867adce9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e66446caf21dd90191dc07a13ce2378"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interr_8c.html#a5e66446caf21dd90191dc07a13ce2378">TIM5_IRQHandler</a> (void)</td></tr>
<tr class="memdesc:a5e66446caf21dd90191dc07a13ce2378"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interrupt service routine for the TIM5 timer.  <a href="interr_8c.html#a5e66446caf21dd90191dc07a13ce2378">More...</a><br /></td></tr>
<tr class="separator:a5e66446caf21dd90191dc07a13ce2378"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Interrupt service routines for the STM32F4 platform. </p>
<dl class="section author"><dt>Author</dt><dd>SDG2. Román Cárdenas (<a href="#" onclick="location.href='mai'+'lto:'+'r.c'+'ar'+'den'+'as'+'@up'+'m.'+'es'; return false;">r.car<span style="display: none;">.nosp@m.</span>dena<span style="display: none;">.nosp@m.</span>s@upm<span style="display: none;">.nosp@m.</span>.es</a>) and Josué Pagán (<a href="#" onclick="location.href='mai'+'lto:'+'j.p'+'ag'+'an@'+'up'+'m.e'+'s'; return false;">j.pag<span style="display: none;">.nosp@m.</span>an@u<span style="display: none;">.nosp@m.</span>pm.es</a>) </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2025-12-01 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a738473a5b43f6c92b80ce1d3d6f77ed9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a738473a5b43f6c92b80ce1d3d6f77ed9">&#9670;&nbsp;</a></span>EXTI15_10_IRQHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EXTI15_10_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function handles Px10-Px15 global interrupts. </p>
<p>First, this function identifies the line/ pin which has raised the interruption. Then, perform the desired action. Before leaving it cleans the interrupt pending register.</p>
<blockquote class="doxtable">
<p><b>TODO alumnos Version 1</b></p>
<p>✅ 1. Retrieve the values of the GPIO of the user button using the <code>PORT_PARKING_BUTTON_ID</code> index to get the port and pin from the <code>buttons_arr</code> using its getter function <code><a class="el" href="port__button_8h.html#ab9ad7f1e29515f13faad2246691d35b8" title="Get the value of the GPIO connected to the button.">port_button_get_value()</a></code>. <br  />
✅ 2. If the value is <code>true</code> means that the button as been released, therefore set the field <code>flag_pressed</code> to <code>false</code> <br  />
✅ 3. If the value is <code>false</code> means that the button as been pressed, therefore set the field <code>flag_pressed</code> to <code>true</code> <br  />
✅ 4. Clean the corresponding bit of the <code>PR</code> register <br  />
&#160;&#160;&#160;&#160;💡 Recommendation: use the macro <code>BIT_POS_TO_MASK</code> <br  />
&#160;&#160;&#160;&#160;💡 <b>To clean an interrupt in the <em>Pending Register</em> (<code>PR</code>) we must write '1' in the corresponding bit</b>. <em>Look at the example in section "Ejemplo de interrupción externa" of the reference book.</em> You can also find this out by consulting the <em>reference manual</em> <a href="https://www.st.com/resource/en/reference_manual/rm0390-stm32f446xx-advanced-armbased-32bit-mcus-stmicroelectronics.pdf">STM32F446xx Advanced ARM-based 32-bit MCUs</a> (See section "10.3.6 Pending register (EXTI_PR)") <br  />
</p>
</blockquote>
<blockquote class="doxtable">
<p><b>TODO alumnos Version 4</b></p>
<p>✅ 1. Call the function <code><a class="el" href="port__system_8h.html#a2dca6b2c8ee48c36828b323f42c47fc8" title="Resume Tick increment.">port_system_systick_resume()</a></code> to resume the systick timer at the beginning of the ISR <br  />
</p>
</blockquote>

</div>
</div>
<a id="ab5e09814056d617c521549e542639b7e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5e09814056d617c521549e542639b7e">&#9670;&nbsp;</a></span>SysTick_Handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SysTick_Handler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interrupt service routine for the System tick timer (SysTick). </p>
<dl class="section note"><dt>Note</dt><dd>This ISR is called when the SysTick timer generates an interrupt. The program flow jumps to this ISR and increments the tick counter by one millisecond.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd><b>The variable <code>msTicks</code> must be declared volatile!</b> Just because it is modified by a call of an ISR, in order to avoid <a href="https://en.wikipedia.org/wiki/Race_condition"><em>race conditions</em></a> . <b>Added to the definition</b> after <em>static</em>. </dd></dl>

</div>
</div>
<a id="a38ad4725462bdc5e86c4ead4f04b9fc2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38ad4725462bdc5e86c4ead4f04b9fc2">&#9670;&nbsp;</a></span>TIM2_IRQHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TIM2_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interrupt service routine for the TIM2 timer. </p>
<p>This timer controls the duration of the echo signal of the ultrasound sensor by means of the input capture mode.</p>
<p><b>The timer can interrupt in two cases:</b></p><ol type="1">
<li>When the echo signal has not been received and the ARR register overflows. In this case, the echo_overflows counter is incremented.</li>
<li>When the echo signal has been received. In this case, the echo_init_tick and echo_end_tick are updated.</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>Follow the example of the section <code>Ejemplo: captura de entrada (input capture)</code> of the <code>Libro de Fundamentos</code> to manage the ISR correctly.</dd></dl>
<blockquote class="doxtable">
<p><b>TODO alumnos</b></p>
<p>✅ 1. Check if the UIF flag is set. <b>If so</b>, this means that the ARR register has overflowed. In this case: <br  />
nbsp;&#160;&#160;&#160; <b>Increment the <code>echo_overflows</code> counter</b>. To do this, use the functions <code><a class="el" href="port__ultrasound_8h.html#a3c1fa21bfaacc552d9c3d38b05db217d" title="Set the number of overflows of the echo signal timer.">port_ultrasound_set_echo_overflows()</a></code> and <code><a class="el" href="port__ultrasound_8h.html#a2d21bece407596a4e345734a65490983" title="Get the number of overflows of the echo signal timer.">port_ultrasound_get_echo_overflows()</a></code> with the corresponding ultrasound ID and the incremented value. <br  />
&#160;&#160;&#160;&#160; <b>Remember to clear the UIF flag</b>. <br  />
✅ 2. Check if the CCxIF flag is set. <b>If so</b>, this means that the input capture event has occurred. &#160;&#160;&#160;&#160; <b>Read the value of the CCRx register</b> to get the current tick. <br  />
&#160;&#160;&#160;&#160; <b>If both the <code>echo_init_tick</code> and <code>echo_end_tick</code> are 0</b>, this means that the echo signal has not started yet. In this case, <b>update the <code>echo_init_tick</code> with the current tick</b>. <br  />
&#160;&#160;&#160;&#160; <b>Otherwise</b>, <b>update the <code>echo_end_tick</code> with the current tick</b> and set the <code>echo_received</code> flag to <code>true</code>. <br  />
&#160;&#160;&#160;&#160;💡 Use the port functions <code>port_ultrasound_get_echo_xxx</code> and <code>port_ultrasound_set_echo_xxx</code>. <br  />
</p>
</blockquote>

</div>
</div>
<a id="ac8e51d2183b5230cbd5481f8867adce9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8e51d2183b5230cbd5481f8867adce9">&#9670;&nbsp;</a></span>TIM3_IRQHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TIM3_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interrupt service routine for the TIM3 timer. </p>
<p>This timer controls the duration of the trigger signal of the ultrasound sensor. When the interrupt occurs it means that the time of the trigger signal has expired and must be lowered.</p>
<blockquote class="doxtable">
<p><b>TODO alumnos</b></p>
<p>✅ 1. Clear the interrupt flag <b>UIF</b> in the status register <b>SR</b>. <br  />
✅ 2. Call the function <code><a class="el" href="port__ultrasound_8h.html#a28e921af96b431d832fd574ee90b3baa" title="Set the status of the trigger signal.">port_ultrasound_set_trigger_end()</a></code> to set the flag that indicates that the time of the trigger signal has expired. </p>
</blockquote>

</div>
</div>
<a id="a5e66446caf21dd90191dc07a13ce2378"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e66446caf21dd90191dc07a13ce2378">&#9670;&nbsp;</a></span>TIM5_IRQHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TIM5_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interrupt service routine for the TIM5 timer. </p>
<p>This timer controls the duration of the measurements of the ultrasound sensor. When the interrupt occurs it means that the time of the a measurement has expired and a new measurement can be started.</p>
<blockquote class="doxtable">
<p><b>TODO alumnos</b></p>
<p>✅ 1. Clear the interrupt flag <b>UIF</b> in the status register <b>SR</b>. <br  />
✅ 2. Call the function <code><a class="el" href="port__ultrasound_8h.html#aae5b7c5a7e58b8498b58258ce9ae4e15" title="Set the readiness of the trigger signal.">port_ultrasound_set_trigger_ready()</a></code> to set the flag that indicates that a new measurement can be started. </p>
</blockquote>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_651562d8bf6cfd3e81eff5b570d7df50.html">port</a></li><li class="navelem"><a class="el" href="dir_aff93352f483d815f4aad2ce8569e33b.html">stm32f4</a></li><li class="navelem"><a class="el" href="dir_96ea3e7ce74ccff9e7229beeb516906f.html">src</a></li><li class="navelem"><a class="el" href="interr_8c.html">interr.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
